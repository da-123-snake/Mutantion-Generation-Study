# Mutation-Generation-Study

## 1. Environment
* Python 3.7
* PyTorch 1.3
* Defects4J V2.0
* Java 8
* ConDefects

## 2.RUN
Defects4J V2.0 should be installed in this directory. For the installation path of Defects4J, please refer to https://github.com/rjust/defects4j. After the installation is complete, run the download.py script to download the fixed and buggy versions of the code for the Defects4J project.

### (1) Generate mutations

**LLMS**: For GPT-3.5, GPT-4o, GPT-4omini, DeepSeek, CodeLlama and StarChat, you can directly run `generate.py` and then choose the corresponding model to generate mutations. You can also select to generate mutations for Defects4J or ConDefects, or define your own storage path.It is important to note that running GPT-3.5, GPT-4o, GPT-4omini, and DeepSeek requires you to apply for an API key yourself, while CodeLlama and StarChat need the models to be downloaded in advance to a specified location.

**LEAM**: To use LEAM to generate mutations, first you need to git clone https://github.com/tianzhaotju/LEAM.git in the Leam directory. Then, use `Leam/testDefects4jV1Fixed.py` and `Leam/run.py` to replace the corresponding files in the downloaded Leam-main folder. Next, put `Leam/get_location.py` into the Leam-main.py file. Finally, run `Leam/Leam-main/get_location.py`, `Leam/Leam-main/testDefects4jV1Fixed.py`, and `Leam/leamdiff.py` in order to generate the mutations, which will be saved in the Leam/mutant directory.

**mBert**: To use mBERT to generate mutations, you first need to run `download-codebert.py` to download and store the language model CodeBERT. Then, run `mbert_generate_mutant.py` to generate the mutations, which will be stored in the mBERTm/mbert_mutant folder.

**Major**: First, set up the major environment and change the Java compiler. Then, run `major/major_generate.py` and `major/get_json_mutant.py` to obtain the mutations generated by MAJOR. The generated mutations will be saved in the major/major_mutant directory.

**Pitest**: You can directly run `pitest/pitest_generate.py` to generate mutations, and the generated mutations will be stored in the pitest/Pitest_mutant directory.

### (2)Test mutations

For each method(LLMS, LEAM, mBert, Major, Pitest), you can directly run `test.py` to test the generated mutations. The test results will be stored in the respective tested directories (need to choose the storage path yourself). And the number of all generated mutants and the number of mutants that passed compilation will be output.



## 3.Evaluate
All the data generated during the experiment has been stored here: https://drive.google.com/drive/folders/170jWUSRuwqjOBNwIGLtk9HKCg1vS_8pj

To evaluate the generated mutations, we have defined several metrics: Compilability Rate, Useless Mutation Ratio, Real Bug Detectability, Coupling Rate, Ochiai Coefficient and so on. For all methods except pitest you can:

(1)Run behavior.py to filter the generated and compiled mutants, and obtain the number of real faults detected for each project. And calculate the Real Bug Detectability,Ochiai Coefficient for each project.

(2)Run coup.py to calculate the coupling rate for each project.

(3)Run count_num.py to sample the generated mutants 10 times, calculate the metrics mentioned above, and output the average values.

(4)Run gumtreeAST.py to calculate the AST difference between two Spoon abstract syntax trees.

It's worth noting that for Pitest, you need to run piGPT.py to obtain the number of generated mutants and the number of mutants that passed compilation. And run pitest_coupling.py,pitest_fault.py,pitest_ochiai.py to calculate the coupling rate,Real Bug Detectability,Ochiai Coefficient for each project. Run pitest_count_num.py to sample the generated mutants 10 times, calculate the metrics mentioned above, and output the average values. sample.xlsx contains the sampled mutations and results that we used to calculate equivalent mutations.
